/*
 * SPServices - Work with SharePoint's Web Services using jQuery
 * Version 0.4.5
 * @requires jQuery v1.3.2
 *
 * Copyright (c) 2009 Sympraxis Consulting LLC
 * Examples and docs at:
 * http://spservices.codeplex.com
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
/**
 * @description Work with SharePoint's Web Services using jQuery
 * @type jQuery
 * @name SPServices
 * @category Plugins/SPServices
 * @author Sympraxis Consulting LLC/marc.anderson@sympraxisconsulting.com
 */
(function(c){var q=new Array();q.Alerts="Alerts";q.Authentication="Authentication";q.Copy="Copy";q.Forms="Forms";q.Lists="Lists";q.Permissions="Permissions";q.PublishedLinksService="PublishedLinksService";q.Search="Search";q.usergroup="usergroup";q.UserProfileService="UserProfileService";q.Views="Views";q.Versions="Versions";q.WebPartPages="WebPartPages";q.Webs="Webs";q.Workflow="Workflow";var b=new Array();b.GetAlerts=q.Alerts;b.DeleteAlerts=q.Alerts;b.Mode=q.Authentication;b.Login=q.Authentication;b.CopyIntoItemsLocal=q.Copy;b.GetForm=q.Forms;b.GetFormCollection=q.Forms;b.AddList=q.Lists;b.CheckInFile=q.Lists;b.CheckOutFile=q.Lists;b.DeleteList=q.Lists;b.GetAttachmentCollection=q.Lists;b.GetList=q.Lists;b.GetListAndView=q.Lists;b.GetListCollection=q.Lists;b.GetListItems=q.Lists;b.UpdateListItems=q.Lists;b.GetPermissionCollection=q.Permissions;b.GetLinks=q.PublishedLinksService;b.GetPortalSearchInfo=q.Search;b.GetSearchMetadata=q.Search;b.Query=q.Search;b.Status=q.Search;b.AddGroup=q.usergroup;b.AddGroupToRole=q.usergroup;b.AddRole=q.usergroup;b.GetAllUserCollectionFromWeb=q.usergroup;b.GetGroupCollection=q.usergroup;b.GetGroupCollectionFromRole=q.usergroup;b.GetGroupCollectionFromSite=q.usergroup;b.GetGroupCollectionFromUser=q.usergroup;b.GetGroupCollectionFromWeb=q.usergroup;b.GetGroupInfo=q.usergroup;b.GetRoleCollection=q.usergroup;b.GetRoleCollectionFromGroup=q.usergroup;b.GetRoleCollectionFromUser=q.usergroup;b.GetRoleCollectionFromWeb=q.usergroup;b.GetRolesAndPermissionsForCurrentUser=q.usergroup;b.GetRolesAndPermissionsForSite=q.usergroup;b.GetUserCollection=q.usergroup;b.GetUserCollectionFromGroup=q.usergroup;b.GetUserCollectionFromRole=q.usergroup;b.GetUserCollectionFromSite=q.usergroup;b.GetUserCollectionFromWeb=q.usergroup;b.GetUserInfo=q.usergroup;b.GetUserLoginFromEmail=q.usergroup;b.RemoveGroup=q.usergroup;b.GetCommonMemberships=q.UserProfileService;b.GetUserColleagues=q.UserProfileService;b.GetUserLinks=q.UserProfileService;b.GetUserMemberships=q.UserProfileService;b.GetUserPinnedLinks=q.UserProfileService;b.GetUserProfileByName=q.UserProfileService;b.GetUserProfileCount=q.UserProfileService;b.GetUserProfileSchema=q.UserProfileService;b.GetViewCollection=q.Views;b.DeleteAllVersions=q.Versions;b.DeleteVersion=q.Versions;b.GetVersions=q.Versions;b.RestoreVersion=q.Versions;b.GetWebPart2=q.WebPartPages;b.GetWebPartPage=q.WebPartPages;b.GetWebPartProperties=q.WebPartPages;b.GetWebPartProperties2=q.WebPartPages;b.GetListTemplates=q.Webs;b.GetWeb=q.Webs;b.GetWebCollection=q.Webs;b.GetAllSubWebCollection=q.Webs;b.WebUrlFromPageUrl=q.Webs;b.GetTemplatesForItem=q.Workflow;b.GetToDosForItem=q.Workflow;b.GetWorkflowDataForItem=q.Workflow;b.GetWorkflowTaskData=q.Workflow;b.StartWorkflow=q.Workflow;var h=new Object();h.header="<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body>";h.footer="</soap:Body></soap:Envelope>";h.payload="";c.fn.SPServices=function(v){var w=c.extend({},c.fn.SPServices.defaults,v);h.opheader="<"+w.operation+" ";switch(b[w.operation]){case q.Alerts:h.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/";break;case q.Permissions:h.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case q.PublishedLinksService:h.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/";break;case q.Search:h.opheader+="xmlns='urn:Microsoft.Search' >";SOAPAction="urn:Microsoft.Search/";break;case q.usergroup:h.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case q.UserProfileService:h.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/";break;case q.WebPartPages:h.opheader+="xmlns='http://microsoft.com/sharepoint/webpartpages' >";SOAPAction="http://microsoft.com/sharepoint/webpartpages/";break;case q.Workflow:h.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/workflow/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/workflow/";break;default:h.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/'>";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/";break}SOAPAction+=w.operation;h.opfooter="</"+w.operation+">";var x=((w.webURL!="")?w.webURL:c().SPServices.SPGetCurrentSite())+"/_vti_bin/"+b[w.operation]+".asmx";h.payload="";switch(w.operation){case"GetAlerts":break;case"DeleteAlerts":h.payload+="<IDs>";for(i=0;i<w.IDs.length;i++){h.payload+=d("string",w.IDs[i])}h.payload+="</IDs>";break;case"Mode":break;case"Login":h.payload+=d("username",w.username);h.payload+=d("password",w.password);break;case"CopyIntoItemsLocal":h.payload+=d("SourceUrl",w.SourceUrl);h.payload+="<DestinationUrls>";for(i=0;i<w.DestinationUrls.length;i++){h.payload+=d("string",w.DestinationUrls[i])}h.payload+="</DestinationUrls>";break;case"GetForm":h.payload+=d("listName",w.listName);h.payload+=d("formUrl",w.formUrl);break;case"GetFormCollection":h.payload+=d("listName",w.listName);break;case"AddList":h.payload+=d("listName",w.listName);h.payload+=d("description",w.description);h.payload+=d("templateID",w.templateID);break;case"CheckInFile":h.payload+=d("pageUrl",w.pageUrl);h.payload+=d("comment",w.comment);h.payload+=d("CheckinType",w.CheckinType);break;case"CheckOutFile":h.payload+=d("pageUrl",w.pageUrl);h.payload+=d("checkoutToLocal",w.checkoutToLocal);h.payload+=d("lastmodified",w.lastmodified);break;case"DeleteList":h.payload+=d("listName",w.listName);break;case"GetAttachmentCollection":h.payload+=d("listName",w.listName);h.payload+=d("listItemID",w.ID);break;case"GetList":h.payload+=d("listName",w.listName);break;case"GetListAndView":h.payload+=d("listName",w.listName);h.payload+=d("viewName",w.viewName);break;case"GetListCollection":break;case"GetListItems":h.payload+=d("listName",w.listName);h.payload+=d("viewFields",w.CAMLViewFields);h.payload+=d("query",w.CAMLQuery);h.payload+=d("rowLimit",w.CAMLRowLimit);h.payload+=d("queryOptions",w.CAMLQueryOptions);break;case"UpdateListItems":h.payload+=d("listName",w.listName);if(w.updates.length>0){h.payload+=d("updates",w.updates)}else{h.payload+="<updates><Batch OnError='Continue'><Method ID='1' Cmd='"+w.batchCmd+"'>";for(i=0;i<w.valuepairs.length;i++){h.payload+="<Field Name='"+w.valuepairs[i][0]+"'>"+w.valuepairs[i][1]+"</Field>"}h.payload+="<Field Name='ID'>"+w.ID+"</Field>";h.payload+="</Method></Batch></updates>"}break;case"GetPermissionCollection":h.payload+=d("objectName",w.objectName);h.payload+=d("objectType",w.objectType);break;case"GetLinks":break;case"GetPortalSearchInfo":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+w.operation;h.opheader="<"+w.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"GetSearchMetadata":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+w.operation;h.opheader="<"+w.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"Query":h.payload+=d("queryXml",m(w.queryXml));break;case"Status":break;case"AddGroup":h.payload+=d("groupName",w.groupName);h.payload+=d("ownerIdentifier",w.ownerIdentifier);h.payload+=d("ownerType",w.ownerType);h.payload+=d("defaultUserLoginName",w.defaultUserLoginName);h.payload+=d("groupName",w.groupName);h.payload+=d("description",w.description);break;case"AddGroupToRole":h.payload+=d("groupName",w.groupName);h.payload+=d("roleName",w.roleName);break;case"AddRole":h.payload+=d("roleName",w.roleName);h.payload+=d("description",w.description);h.payload+=d("permissionMask",w.permissionMask);break;case"GetAllUserCollectionFromWeb":break;case"GetGroupCollectionFromRole":h.payload+=d("roleName",w.roleName);break;case"GetGroupCollection":h.payload+=d("groupNamesXml",w.groupNamesXml);break;case"GetGroupCollectionFromSite":break;case"GetGroupCollectionFromUser":h.payload+=d("userLoginName",w.userLoginName);break;case"GetGroupCollectionFromWeb":break;case"GetGroupInfo":h.payload+=d("groupName",w.groupName);break;case"GetRoleCollection":h.payload+=d("roleNamesXml",w.roleNamesXml);break;case"GetRoleCollectionFromGroup":h.payload+=d("groupName",w.groupName);break;case"GetRoleCollectionFromUser":h.payload+=d("userLoginName",w.userLoginName);break;case"GetRoleCollectionFromWeb":break;case"GetRoleInfo":h.payload+=d("roleName",w.roleName);break;case"GetRolesAndPermissionsForCurrentUser":break;case"GetRolesAndPermissionsForSite":break;case"GetUserCollection":h.payload+=d("userLoginNamesXml",w.userLoginNamesXml);break;case"GetUserCollectionFromGroup":h.payload+=d("groupName",w.groupName);break;case"GetUserCollectionFromRole":h.payload+=d("roleName",w.roleName);break;case"GetUserCollectionFromSite":break;case"GetUserCollectionFromWeb":break;case"GetUserInfo":h.payload+=d("userLoginName",w.userLoginName);break;case"GetUserLoginFromEmail":h.payload+=d("emailXml",w.emailXml);break;case"RemoveGroup":h.payload+=d("groupName",w.groupName);break;case"GetCommonMemberships":h.payload+=d("accountName",w.accountName);break;case"GetUserColleagues":h.payload+=d("accountName",w.accountName);break;case"GetUserLinks":h.payload+=d("accountName",w.accountName);break;case"GetUserMemberships":h.payload+=d("accountName",w.accountName);break;case"GetUserPinnedLinks":h.payload+=d("accountName",w.accountName);break;case"GetUserProfileByName":if(w.accountName.length>0){h.payload+=d("AccountName",w.accountName)}else{h.payload+=d("AccountName",w.AccountName)}break;case"GetUserProfileCount":break;case"GetUserProfileSchema":break;case"GetViewCollection":h.payload+=d("listName",w.listName);break;case"DeleteAllVersions":h.payload+=d("fileName",w.fileName);break;case"DeleteVersion":h.payload+=d("fileName",w.fileName);h.payload+=d("fileVersion",w.fileVersion);break;case"GetVersions":h.payload+=d("fileName",w.fileName);break;case"RestoreVersion":h.payload+=d("fileName",w.fileName);h.payload+=d("fileVersion",w.fileVersion);break;case"GetWebPart2":h.payload+=d("pageUrl",w.pageUrl);h.payload+=d("storageKey",w.storageKey);h.payload+=d("storage",w.storage);h.payload+=d("behavior",w.behavior);break;case"GetWebPartPage":h.payload+=d("documentName",w.documentName);h.payload+=d("behavior",w.behavior);break;case"GetWebPartProperties":h.payload+=d("pageUrl",w.pageUrl);h.payload+=d("storage",w.storage);break;case"GetWebPartProperties2":h.payload+=d("pageUrl",w.pageUrl);h.payload+=d("storage",w.storage);h.payload+=d("behavior",w.behavior);break;case"GetWeb":h.payload+=d("webUrl",w.webURL);break;case"GetListTemplates":break;case"GetWebCollection":break;case"GetAllSubWebCollection":break;case"WebUrlFromPageUrl":h.payload+=d("pageUrl",w.pageURL);break;case"GetTemplatesForItem":h.payload+=d("item",w.item);break;case"GetToDosForItem":h.payload+=d("item",w.item);break;case"GetWorkflowDataForItem":h.payload+=d("item",w.item);break;case"GetWorkflowTaskData":h.payload+=d("item",w.item);h.payload+=d("listId",w.listId);h.payload+=d("taskId",w.taskId);break;case"StartWorkflow":h.payload+=d("item",w.item);h.payload+=d("templateId",w.templateId);h.payload+=d("workflowParameters",w.workflowParameters);break;default:break}var y=h.header+h.opheader+h.payload+h.opfooter+h.footer;c.ajax({url:x,async:w.async,beforeSend:function(z){z.setRequestHeader("SOAPAction",SOAPAction)},type:"POST",data:y,dataType:"xml",contentType:"text/xml; charset='utf-8'",complete:w.completefunc})};c.fn.SPServices.defaults={operation:"",webURL:"",pageURL:"",listName:"",description:"",templateID:"",viewName:"",formUrl:"",fileName:"",fileVersion:"",ID:1,updates:"",comment:"",CheckinType:"",checkoutToLocal:"",lastmodified:"",CAMLViewName:"",CAMLQuery:"",CAMLViewFields:"",CAMLRowLimit:0,CAMLQueryOptions:"<QueryOptions></QueryOptions>",batchCmd:"Update",valuepairs:[],username:"",password:"",accountName:"",AccountName:"",userLoginName:"",groupNamesXml:"",groupName:"",ownerIdentifier:"",ownerType:"",defaultUserLoginName:"",roleNamesXml:"",roleName:"",permissionMask:"",userLoginNamesXml:"",emailXml:"",objectName:"",objectType:"List",IDs:null,SourceUrl:"",DestinationUrls:[],documentName:"",behavior:"Version3",storageKey:"",storage:"Shared",item:"",listId:"",taskId:"",templateId:"",workflowParameters:"",fClaim:false,queryXml:"",async:true,completefunc:null};c.fn.SPServices.SPGetCurrentSite=function(){var v="";var w=h.header+"<WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+((location.href.indexOf("?")>0)?location.href.substr(0,location.href.indexOf("?")):location.href)+"</pageUrl></WebUrlFromPageUrl>"+h.footer;c.ajax({async:false,url:"/_vti_bin/Webs.asmx",beforeSend:function(x){x.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/WebUrlFromPageUrl")},type:"POST",data:w,dataType:"xml",contentType:'text/xml; charset="utf-8"',complete:function(y,x){v=c(y.responseXML).find("WebUrlFromPageUrlResult").text()}});return v};c.fn.SPServices.SPCascadeDropdowns=function(v){var x=c.extend({},{relationshipWebURL:"",relationshipList:"",relationshipListParentColumn:"",relationshipListChildColumn:"",relationshipListSortColumn:"",parentColumn:"",childColumn:"",debug:false},v);var w=new g(x.parentColumn);if(w.Obj.html()==null&&x.debug){e("SPServices.SPCascadeDropdowns","parentColumn: "+x.parentColumn,"Column not found on page");return}switch(w.Type){case"S":w.Obj.bind("change",function(){t(x)});w.Obj.change();break;case"C":w.Obj.bind("propertychange",function(){t(x)});w.Obj.trigger("propertychange");break;case"M":t(x);break;default:break}};function t(y){var B="";var w=null;var z=null;var x=new g(y.parentColumn);var v=new g(y.childColumn);if(v.Obj.html()==null&&y.debug){e("SPServices.SPCascadeDropdowns","childColumn: "+y.childColumn,"Column not found on page");return}switch(x.Type){case"S":z=x.Obj.find("option:selected").text();break;case"C":z=x.Obj.attr("value");break;case"M":break;default:break}switch(v.Type){case"S":w=v.Obj.find("option:selected").val();break;case"C":w=v.Obj.attr("value");break;case"M":break;default:break}var A=(y.relationshipListSortColumn.length>0)?y.relationshipListSortColumn:y.relationshipListChildColumn;c().SPServices({operation:"GetListItems",async:false,webURL:y.relationshipWebURL,listName:y.relationshipList,CAMLQuery:"<Query><OrderBy><FieldRef Name='"+A+"'/></OrderBy><Where><Eq><FieldRef Name='"+y.relationshipListParentColumn+"'/><Value Type='Text'>"+z+"</Value></Eq></Where></Query>",CAMLViewFields:"<ViewFields><FieldRef Name='"+y.relationshipListParentColumn+"' /><FieldRef Name='"+y.relationshipListChildColumn+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(E,C){c(E.responseXML).find("faultcode").each(function(){if(y.debug){e("SPServices.SPCascadeDropdowns","relationshipListParentColumn: "+y.relationshipListParentColumn+" or relationshipListChildColumn: "+y.relationshipListChildColumn,"Not found in relationshipList "+y.relationshipList)}return});switch(v.Type){case"S":v.Obj.attr({length:0}).append("<option value='0'>Choose "+y.childColumn+"...</option>");break;case"C":B="(None)|0";v.Obj.attr("value","");break;case"M":v.Obj.attr({length:0});multiSelectedValuesObj.attr({length:0});break;default:break}var D=f(E.responseXML);c(D).each(function(){switch(v.Type){case"S":var F=(c(this).attr("ows_ID")==w)?" selected='selected'":"";v.Obj.append("<option"+F+" value='"+c(this).attr("ows_ID")+"'>"+c(this).attr("ows_"+y.relationshipListChildColumn)+"</option>");break;case"C":if(c(this).attr("ows_"+y.relationshipListChildColumn)==w){v.Obj.attr("value",w)}B=B+"|"+c(this).attr("ows_"+y.relationshipListChildColumn)+"|"+c(this).attr("ows_ID");break;case"M":v.Obj.append("<option value='"+c(this).attr("ows_ID")+"'>"+c(this).attr("ows_"+y.relationshipListChildColumn)+"</option>");break;default:break}});switch(v.Type){case"S":v.Obj.trigger("change");break;case"C":v.Obj.attr("choices",B);v.Obj.trigger("propertychange");break;case"M":break;default:break}}})}c.fn.SPServices.SPDisplayRelatedInfo=function(v){var w=c.extend({},{columnName:"",relatedWebURL:"",relatedList:"",relatedListColumn:"",relatedColumns:[],displayFormat:"table",headerCSSClass:"ms-vh2",rowCSSClass:"ms-vb",debug:false},v);var x=new g(w.columnName);if(x.Obj.html()==null&&w.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+w.columnName,"Column not found on page");return}switch(x.Type){case"S":x.Obj.bind("change",function(){u(w)});x.Obj.change();break;case"C":x.Obj.bind("propertychange",function(){u(w)});x.Obj.trigger("propertychange");break;case"M":if(w.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+w.columnName,"Multi-select columns not support by this function")}break;default:break}};function u(z){var v=null;var A=new g(z.columnName);var x="showRelated_"+r(z.columnName);c("#"+x).remove();A.Obj.parent().append("<div id="+x+"></div>");switch(A.Type){case"S":v=A.Obj.find("option:selected").text();break;case"C":v=A.Obj.attr("value");break;case"M":break;default:break}var y=[];c().SPServices({operation:"GetList",async:false,webURL:z.relatedWebURL,listName:z.relatedList,completefunc:function(C,B){c(C.responseXML).find("faultcode").each(function(){if(z.debug){e("SPServices.SPDisplayRelatedInfo","relatedList: "+z.relatedList,"List not found")}return});c(C.responseXML).find("Fields").each(function(){c(C.responseXML).find("Field").each(function(){for(i=0;i<z.relatedColumns.length;i++){if(c(this).attr("Name")==z.relatedColumns[i]){y[i]=c(this)}}})})}});var w=" ";for(i=0;i<z.relatedColumns.length;i++){w+="<FieldRef Name='"+z.relatedColumns[i]+"' />"}c().SPServices({operation:"GetListItems",async:false,webURL:z.relatedWebURL,listName:z.relatedList,CAMLQuery:"<Query><Where><Eq><FieldRef Name='"+z.relatedListColumn+"'/><Value Type='Text'>"+v+"</Value></Eq></Where></Query>",CAMLViewFields:"<ViewFields>"+w+"</ViewFields>",CAMLRowLimit:0,completefunc:function(E,C){c(E.responseXML).find("faultcode").each(function(){if(z.debug){e("SPServices.SPDisplayRelatedInfo","relatedListColumn: "+z.relatedListColumn,"Column not found in relatedList "+z.relatedList)}return});switch(z.displayFormat){case"table":var B="<table>";B+="<tr>";for(i=0;i<z.relatedColumns.length;i++){B+="<th class='"+z.headerCSSClass+"'>"+y[i].attr("DisplayName")+"</th>"}B+="</tr>";var D=f(E.responseXML);c(D).each(function(){B+="<tr>";for(i=0;i<z.relatedColumns.length;i++){B+="<td class='"+z.rowCSSClass+"'>"+s(y[i],c(this).attr("ows_"+z.relatedColumns[i]),z)+"</td>"}B+="</tr>"});B+="</table>";c("#showRelated_"+r(z.columnName)).html("").append(B);break;case"list":var B="<table>";for(i=0;i<z.relatedColumns.length;i++){c(E.responseXML).find("z\\:row").each(function(){B+="<tr>";B+="<th class='"+z.headerCSSClass+"'>"+y[i].attr("DisplayName")+"</th>";B+="<td class='"+z.rowCSSClass+"'>"+s(y[i],c(this).attr("ows_"+z.relatedColumns[i]),z)+"</td>";B+="</tr>"})}B+="</table>";c("#showRelated_"+r(z.columnName)).html("").append(B);break;default:break}}})}c.fn.SPServices.SPDebugXMLHttpResult=function(w){var y=c.extend({},{node:null,indent:0},w);var A=3;var z=4;var v="";v+="<table class='ms-vb' style='margin-left:"+y.indent*3+"px;' width='100%'>";if(y.node.nodeName=="DisplayPattern"){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+y.node.xml+"</textarea></td></tr>"}else{if(!y.node.hasChildNodes()){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td>"+((y.node.nodeValue!=null)?o(y.node.nodeValue):"&nbsp;")+"</td></tr>";if(y.node.attributes){v+="<tr><td colspan='99'>";v+=a(y.node,y);v+="</td></tr>"}}else{if(y.node.hasChildNodes()&&y.node.firstChild.nodeType==z){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+y.node.parentNode.text+"</textarea></td></tr>"}else{if(y.node.hasChildNodes()&&y.node.firstChild.nodeType==A){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td>"+o(y.node.firstChild.nodeValue)+"</td></tr>"}else{v+="<tr><td width='100px' style='font-weight:bold;' colspan='99'>"+y.node.nodeName+"</td></tr>";if(y.node.attributes){v+="<tr><td colspan='99'>";v+=a(y.node,y);v+="</td></tr>"}v+="<tr><td>";for(var x=0;x<y.node.childNodes.length;x++){v+=c().SPServices.SPDebugXMLHttpResult({node:y.node.childNodes.item(x),indent:y.indent+1})}v+="</td></tr>"}}}}v+="</table>";return v};c.fn.SPServices.SPGetCurrentUser=function(){var v="";c.ajax({async:false,url:"/_layouts/userdisp.aspx?Force=True",complete:function(x,w){c(x.responseText).find("table.ms-formtable td#SPFieldText").each(function(){if(/FieldInternalName=\"Name\"/.test(c(this).html())){v=c(this).text()}})}});return v.replace(/(^[\s\xA0]+|[\s\xA0]+$)/g,"")};c.fn.SPServices.SPLookupAddNew=function(x){var y=c.extend({},{lookupColumn:"",promptText:"Add new {0}",debug:false},x);var w=new g(y.lookupColumn);if(w.Obj.html()==null&&y.debug){e("SPServices.SPLookupAddNew","lookupColumn: "+y.lookupColumn,"Column not found on page");return}var z="";var v="";c().SPServices({operation:"GetList",async:false,listName:p(),completefunc:function(B,A){c(B.responseXML).find("Field").each(function(){if(c(this).attr("DisplayName")==y.lookupColumn){c().SPServices({operation:"GetList",async:false,listName:c(this).attr("List"),completefunc:function(D,C){c(D.responseXML).find("List").each(function(){v=c(this).attr("WebFullUrl")})}});c().SPServices({operation:"GetFormCollection",async:false,listName:c(this).attr("List"),completefunc:function(D,C){c(D.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="NewForm"){z=c(this).attr("Url")}})}})}})}});if(z.length>0){newLink="<a href='"+v+"/"+z+"?Source="+l(location.href)+"'>"+y.promptText.replace(/\{0\}/g,y.lookupColumn)+"</a>";c(w.Obj).parents("td.ms-formbody").append(newLink)}};c.fn.SPServices.SPGetLastItemId=function(v){var x=c.extend({},{webURL:"",listName:"",userAccount:""},v);var w;var y=0;c().SPServices({operation:"GetUserInfo",async:false,userLoginName:(x.userAccount!="")?x.userAccount:c().SPServices.SPGetCurrentUser(),completefunc:function(A,z){c(A.responseXML).find("User").each(function(){w=c(this).attr("ID")})}});c().SPServices({operation:"GetListItems",async:false,webURL:x.webURL,listName:x.listName,CAMLQuery:"<Query><Where><Eq><FieldRef Name='Author' LookupId='TRUE'/><Value Type='Integer'>"+w+"</Value></Eq></Where><OrderBy><FieldRef Name='Created_x0020_Date' Ascending='FALSE'/></OrderBy></Query>",CAMLViewFields:"<ViewFields><FieldRef Name='ID'/></ViewFields>",CAMLRowLimit:1,completefunc:function(B,z){var A=f(B.responseXML);c(A).each(function(){y=c(this).attr("ows_ID")})}});return y};c.fn.SPServices.SPRequireUnique=function(x){var y=c.extend({},{columnStaticName:"Title",duplicateAction:0,ignoreCase:"false",initMsg:"This value must be unique.",initMsgCSSClass:"ms-vb",errMsg:"This value is not unique.",errMsgCSSClass:"ms-formvalidation"},x);var C="<span id='SPRequireUnique' class='{0}'>{1}<br/></span>";var v=C.replace(/\{0\}/g,y.initMsgCSSClass).replace(/\{1\}/g,y.initMsg);var B=C.replace(/\{0\}/g,y.errMsgCSSClass).replace(/\{1\}/g,y.errMsg);var A=p();var z=c().SPServices.SPGetDisplayFromStatic({listName:A,columnStaticName:y.columnStaticName});var w=c("input:[Title='"+z+"']");c(w).parent().append(v);c(w).change(function(){var E=0;var G=c(this).attr("value");c().SPServices({operation:"GetListItems",async:false,listName:p(),CAMLViewFields:"<ViewFields><FieldRef Name='"+z+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(K,H){var J=y.ignoreCase?G.toUpperCase():G;var I=f(K.responseXML);c(I).each(function(){var L=y.ignoreCase?c(this).attr("ows_"+y.columnStaticName).toUpperCase():c(this).attr("ows_"+y.columnStaticName);if(J==L){E++}})}});var D=v;var F="";if(E>0){D=B;F="disabled";if(y.duplicateAction==1){c("input:[Title='"+z+"']").focus()}}c("span#SPRequireUnique").html(D);c("input:[value='OK']").attr("disabled",F)})};c.fn.SPServices.SPGetDisplayFromStatic=function(v){var x=c.extend({},{webURL:"",listName:"",columnStaticName:""},v);var w="";c().SPServices({operation:"GetList",async:false,webURL:x.webURL,listName:x.listName,completefunc:function(z,y){c(z.responseXML).find("Field").each(function(){if(c(this).attr("StaticName")==x.columnStaticName){displayName=c(this).attr("DisplayName")}})}});return displayName};c.fn.SPServices.SPRedirectWithID=function(w){var x=c.extend({},{redirectUrl:""},w);var y=p();var z=k();var A=z.ID;if(z.ID==undefined){A=c().SPServices.SPGetLastItemId({listName:y});c().find("form[name='aspnetForm']").each(function(){var B=(location.href.indexOf("?")>0)?location.href.substring(0,location.href.indexOf("?")):location.href;var C=(typeof z.Source=="string")?"Source="+z.Source.replace(/\//g,"%2f").replace(/:/g,"%3a"):"";var D=B+"?Source="+B+"?ID="+A+((C.length>0)?("%26RealSource="+z.Source):"")+((typeof z.RedirectURL=="string")?("%26RedirectURL="+z.RedirectURL):"");c(this).attr("action",D)})}else{while(z.ID==A){A=c().SPServices.SPGetLastItemId({listName:y})}var v=(typeof z.RedirectURL=="string")?z.RedirectURL:x.redirectUrl;location.href=v+"?ID="+A+((typeof z.RealSource=="string")?("&Source="+z.RealSource):"")}};function s(z,y,x){if(y==undefined){return""}var v;switch(z.attr("Type")){case"Text":v=y;break;case"URL":switch(z.attr("Format")){case"Hyperlink":v="<a href='"+y.substring(0,y.search(","))+"'>"+y.substring(y.search(",")+1)+"</a>";break;case"Image":v="<img alt='"+y.substring(y.search(",")+1)+"' src='"+y.substring(0,y.search(","))+"'/>";break;default:v=y;break}break;case"User":v="<a href='/_layouts/userdisp.aspx?ID="+y.substring(0,y.search(";#"))+"&Source="+l(location.href)+"'>"+y.substring(y.search(";#")+2)+"</a>";break;case"Number":v=parseFloat(y).toFixed(z.attr("Decimals")).toString();break;case"Lookup":var w;c().SPServices({operation:"GetFormCollection",async:false,listName:z.attr("List"),completefunc:function(B,A){c(B.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="DisplayForm"){w=c(this).attr("Url")}})}});v="<a href='"+x.relatedWebURL+"/"+w+"?ID="+y.substring(0,y.search(";#"))+"&RootFolder=*'>"+y.substring(y.search(";#")+2)+"</a>";break;case"Counter":v=y;break;default:v=y;break}return v}function a(y,x){var v="<table class='ms-vb' width='100%'>";for(var w=0;w<y.attributes.length;w++){v+="<tr><td width='10px' style='font-weight:bold;'>"+w+"</td><td width='100px'>"+y.attributes.item(w).nodeName+"</td><td>"+o(y.attributes.item(w).nodeValue)+"</td></tr>"}v+="</table>";return v}function p(){var v=c().SPServices.SPGetCurrentSite();var x=location.href.replace(v,"").replace("/Lists/","");var w=j(x.substr(0,x.search("/")));return w}function g(v){if((this.Obj=c().find("select:[Title='"+v+"']")).html()!=null){this.Type="S"}else{if((this.Obj=c().find("input:[Title='"+v+"']")).html()!=null){this.Type="C"}else{if((this.Obj=c().find("select:[Title='"+v+" possible values']")).html()!=null){this.Type="M"}else{this.Type=null}}}}function f(x){var v;var w=c(x).find("rs\\:data").attr("ItemCount");if(x.getElementsByTagName("z:row").length==0&&w==undefined){v=x.getElementsByTagNameNS("*","row")}else{v=x.getElementsByTagName("z:row")}return v}function e(w,y,x){var v="<b>Error in function</b><br/>"+w+"<br/><b>Parameter</b><br/>"+y+"<br/><b>Message</b><br/>"+x+"<br/><br/><span style='width=100%;text-align:right;'>Click to continue</span></div>";n(v)}function n(A){var x="position:absolute;width:300px;height:150px;padding:10px;background-color:#000000;color:#ffffff;z-index:30;font-family:'Arial';font-size:12px;display:none;";c().find("#aspnetForm").parent().append("<div id='SPServices_msgBox' style="+x+">"+A);var v=c("#SPServices_msgBox").height();var z=c("#SPServices_msgBox").width();var y=(c(window).width()/2)-(z/2)+"px";var w=(c(window).height()/2)-(v/2)-100+"px";c("#SPServices_msgBox").css({border:"5px #C02000 solid",left:y,top:w}).show().fadeTo("slow",0.75).click(function(){c(this).fadeOut("3000",function(){c(this).remove()})})}function k(){var z=new Object();var v=location.search.substring(1,location.search.length);var x=v.split("&");for(var y=0;y<x.length;y++){var A=x[y].split("=");var w=unescape(A[1]).split("+");A[1]=w.join(" ");z[A[0]]=A[1]}return z}function o(v){return((v.indexOf("http")==0)||(v.indexOf("/")==0))?"<a href='"+v+"'>"+v+"</a>":v}function m(v){return v.replace(/"/g,"&quot;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function j(v){return v.replace(/%20/g," ")}function l(v){return v.replace(/&/g,"%26")}function r(v){return v.replace(/ /g,"_x0020_")}function d(x,w){return"<"+x+">"+w+"</"+x+">"}})(jQuery);